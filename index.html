<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spanky's Mysterious Dice Rolling Simulator (solarcosmic.net)</title>
    <link rel="icon" type="image/png" href="assets/favicon.png"></link>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Epunda+Slab:ital,wght@0,300..900;1,300..900&display=swap');
        * {
            font-family: "Epunda Slab", sans-serif;
        }
        body {
            background-color: black;
            color: #ffffff;
            text-align: center;
            height: 100vh;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            user-select: none;
        }
        #container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60vh;
            width: 100%;
        }
        .select-button {
            display: none;
            color: #ffffff;
            background-color: black;
            padding: 16px 16px;
            opacity: 0;
            transition: opacity 1s;
            pointer-events: none;
            margin: 10px 0;
        }
        #click-anywhere {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: black;
            color: #ffffff;
            text-align: center;
            cursor: pointer;
            font-size: 30px;
        }
        #click-anywhere-text {
            opacity: 1;
            transition: 1s;
        }
        #click-anywhere-text.fade-out {
            opacity: 0;
            transition: 1s;
        }
        .select-button.fade-in {
            display: block;
            opacity: 1;
            pointer-events: auto;
            transition: 1s;
        }
        .select-button.fade-out {
            opacity: 0;
            pointer-events: auto;
            transition: 1s;
        }
        #typewrite {
            font-size: 25px;
        }
        #ending-card {
            background: #0f0f0f;
            color: #ffffff;
            padding: 4px 4px;
            border-radius: 8px;
            position: absolute;
            top: 25px;
            right: 25px;
            text-align: left;
        }
        #ending-name {
            font-size: 25px;
        }
        #ending-collected {
            color: grey;
        }
        #ending-list {
            position: absolute;
            top: 20px;
            right: 20px;
            color: grey;
            font-size: 20px;
        }
        #collected-endings-text {
            position: absolute;
            top: -35px;
            right: 540px;
            color: grey;
            font-size: 20px;
            width: 300px;
        }
        .greyed-out {
            filter: invert(55%) sepia(1%) saturate(0%) hue-rotate(320deg) brightness(91%) contrast(85%);
        }
        #credits-text {
            position: absolute;
            bottom: 20px;
            left: 20px;
            color: grey;
            font-size: 20px;
            text-align: left;
        }
        a {
            color: #b1b1b1;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        .option-selection {
            font-size: 20px;
            color: grey;
            display: flex;
            align-items: center;
        }
        #prompt {
            text-align: left;
        }
        #heart {
            margin-left: 0;
            margin-right: 8px;
            color: red;
        }
    </style>
    <script src="assets/jquery.min.js"></script>
</head>
<body>
    <div id="click-anywhere">
        <span id="click-anywhere-text">Click anywhere</span>
        <span id="ending-list">
            <!--<span id="collected-endings-text">Collected endings (1/5)</span>-->
        </span>
        <span id="credits">
            <span id="credits-text">Spanky's (c) 2025 solarcosmic<br>Made for the <a href="https://summer.hackclub.com/s">Summer of Making expedition</a>!</span>
        </span>
    </div>
    <div id="container">
        <span id="typewrite"></span>
        <button id="roll_die" class="item select-button">roll the d20..</button>
        <p id="rolled"></p>
        <audio id="main-ambience" src="assets/assets_sounds_orch_hit_new.mp3" preload="auto" loop></audio>
        <audio id="ending-popup-sound" src="assets/ending.mp3" preload="auto"></audio>
        <button id="odd" class="item select-button" style="display: none;">Odd</button>
        <button id="even" class="item select-button" style="display: none;">Even</button>
        <div id="prompt">
            <div class="option-selection">
                <span id="heart">➤</span>
                Roll D20
            </div>
            <div class="option-selection">
                Flee
            </div>
        </div>
    </div>
    <div id="ending-card" style="display: none">
        <img src="assets/trophy-solid-full.svg" width="24px" height="24px"></img>
        <span id="ending-name">Example Ending</span><br>
        <span id="ending-description">A test ending...</span><br>
        <span id="ending-collected">X / Y Endings Collected</span>
    </div>
    <script>
        const rolldie = document.getElementById("roll_die");
        const click_anywhere = document.getElementById("click-anywhere");
        var ran_mult = 1;
        var isSecondTime = false;
        const endings = {
            "cheater": {
                "name": "Cheater Ending",
                "description": "You know what you did..."
            },
            "lucky": {
                "name": "Lucky Ending",
                "description": "How did you do it?"
            },
            "determination": {
                "name": "Determination Ending",
                "description": "Something to not give up on!"
            },
            "attempted": {
                "name": "Attempted Ending",
                "description": "Worth a shot! Try again, perhaps?"
            },
            "true": {
                "name": "True Ending",
                "description": "One for all."
            },
        };
        var nav = 1;
        var total_navigator = 2;
        document.addEventListener("keydown", (e) => {
            const key = e.key;
            if (key == "ArrowDown") {
                if ((nav + 1) <= total_navigator) {
                    console.log("approved!");
                    updateNavigator(nav + 1);
                    console.log(nav);
                }
            } else {
                if (key == "ArrowUp") {
                    if ((nav + 1) > total_navigator) {
                        console.log("deapproved!");
                        updateNavigator(nav - 1);
                        console.log(nav);
                    }
                }
            }
        });
        function updateNavigator(val) {
            nav = val;
            const len = document.getElementById("prompt").childElementCount;
            if (nav <= len) {
                console.log("works!");
                const item = document.getElementsByClassName("option-selection")[nav - 1];
                const detect = item.innerHTML.replace(`<span id="heart">➤</span>`, "").trim();
                console.log(detect);
                item.prepend(document.getElementById("heart"));
            }
        }
        click_anywhere.addEventListener("click", () => {
            document.getElementById("click-anywhere-text").classList.add("fade-out");
            document.getElementById("ending-list").classList.add("fade-out");
            document.getElementById("credits-text").classList.add("fade-out");
            setTimeout(async () => {
                click_anywhere.style.display = "none";
                document.getElementById("main-ambience").play();
                typewrite("Welcome to Spanky's...");
                rolldie.classList.add("fade-out");
                await sleep(5000);
                var hrs = new Date().getHours()
                const isDayTime = hrs > 6 && hrs < 20 // https://stackoverflow.com/a/46908558
                var timeOfDay = "right now?";
                if (hrs > 6 && hrs < 12) {
                    timeOfDay = "this morning?";
                } else if (hrs >= 12 && hrs < 18) {
                    timeOfDay = "this afternoon?";
                } else if (hrs >= 18 && hrs < 24) {
                    timeOfDay = "tonight?";
                }
                typewrite("Feeling hopeful " + timeOfDay);
                await sleep(5000);
                typewrite("That's brilliant, but you have a choice to make.");
                await sleep(7000);
                typewrite("Click the button to roll a D20, and let's see what you get.");
                await sleep(7000);
                rolldie.style.display = "block";
                rolldie.classList.remove("fade-out");
                rolldie.classList.add("fade-in");
                var hasClicked = false;
                rolldie.addEventListener("click", async () => {
                    if (hasClicked) return;
                    hasClicked = true;
                    const ran = (Math.floor(Math.random() * 20) + 1) * ran_mult;
                    rolldie.classList.remove("fade-in");
                    rolldie.classList.add("fade-out");
                    typewrite("You rolled a...");
                    await sleep(3500);
                    rolldie.classList.remove("fade-out");
                    rolldie.style.display = "none";
                    if (ran == 4 || ran == 13) {
                        typewrite(".. " + ran + " .. unlucky for some.");
                    } else if (ran < 10) {
                        typewrite(".. " + ran + " .. that's low.");
                    } else if (ran >= 10 && ran < 15) {
                        typewrite(".. " + ran + " .. that's alright.");
                    } else if (ran >= 15 && ran < 18) {
                        typewrite(".. " + ran + " .. that's not too bad.");
                    } else if (ran >= 18 && ran <= 19) {
                        typewrite(".. " + ran + " .. that's near perfect.");
                    } else if (ran == 20) {
                        typewrite(".. " + ran + " .. nat 20.");
                    } else if (ran > 20) {
                        typewrite(".. " + ran + " .. somehow higher than 20.. hmm..");
                    }
                    await sleep(5000);
                    if (isSecondTime == false) {
                        if (ran < 18) {
                            typewrite(".. but not good enough.");
                            await sleep(6000);
                            typewrite("I'll let you reroll again, but on one condition.");
                            await sleep(6000);
                            typewrite("Prove to me you are worthy of advancing.");
                            await sleep(5000);
                            var hasClicked = false;
                            isSecondTime = true
                            rolldie.style.display = "block";
                            rolldie.classList.remove("fade-out");
                            rolldie.classList.add("fade-in");
                        } else if (ran >= 18) {
                            typewrite("Well done.");
                            await sleep(3500);
                            typewrite("Since you have proved to me that you are capable, I'll let you proceed.");
                            if (ran > 20) {
                                doEnding("cheater");
                            } else {
                                doEnding("luck");
                            }
                            await sleep(8000);
                            window.location.href = "https://vw4kks4wwkoswgks4k000gso.a.selfhosted.hackclub.com/scenes/79";
                        }
                    } else if (isSecondTime == true) {
                        if (ran < 18) {
                            typewrite("Since you have not proved to me you are capable, I'll roll a D6.");
                            await sleep(6500);
                            typewrite("Let's make this 50/50. Odd or even?");
                            await sleep(4000);
                            document.getElementById("odd").style.display = "block";
                            document.getElementById("even").style.display = "block";
                            document.getElementById("odd").classList.add("fade-in");
                            document.getElementById("even").classList.add("fade-in");
                        } else if (ran >= 18) {
                            typewrite("For your second try, well done.");
                            await sleep(3500);
                            typewrite("Since you have proved to me that you are capable, I'll let you proceed.");
                            if (ran > 20) {
                                doEnding("cheater");
                            } else {
                                doEnding("luck");
                            }
                            await sleep(8000);
                            window.location.href = "https://vw4kks4wwkoswgks4k000gso.a.selfhosted.hackclub.com/scenes/79";
                        }
                    }
                })
            }, 2000);
        });
        var hasChosenSelection = false;
        document.getElementById("odd").addEventListener("click", () => {
            if (!hasChosenSelection) finalMainPhase("odd");
        })
        document.getElementById("even").addEventListener("click", () => {
            if (!hasChosenSelection) finalMainPhase("even");
        })
        async function finalMainPhase(selection) {
            hasChosenSelection = true;
            document.getElementById("odd").classList.remove("fade-in");
            document.getElementById("even").classList.remove("fade-in");
            document.getElementById("odd").classList.add("fade-out");
            document.getElementById("even").classList.add("fade-out");
            if (selection == "odd") {
                await sleep(1000);
                typewrite("You chose Odd... time to roll.");
                await sleep(4000);
            } else if (selection == "even") {
                await sleep(1000);
                typewrite("You chose Even... time to roll.");
                await sleep(4000);
            }
            await sleep(1000);
            document.getElementById("odd").style.display = "none";
            document.getElementById("even").style.display = "none";
            const ran = (Math.floor(Math.random() * 6) + 1) * ran_mult;
            typewrite("The D6 rolled..");
            await sleep(3000);
            var success = false;
            console.log(ran);
            console.log("odd check: " + (Math.abs(ran % 2) == 1));
            console.log("even check: " + (ran % 2 == 0));
            if ((Math.abs(ran % 2)) == 1) { // odd https://stackoverflow.com/a/6211660
                if (selection == "odd") {
                    success = true;
                    typewrite(".. " + ran + ".. indeed an odd.");
                } else if (selection == "even") {
                    success = false;
                    typewrite(".. " + ran + ".. an odd.");
                }
            } else if ((ran % 2) == 0) { // even https://stackoverflow.com/a/6211660
                if (selection == "odd") {
                    success = false;
                    typewrite(".. " + ran + ".. an even.");
                } else if (selection == "even") {
                    success = true;
                    typewrite(".. " + ran + ".. indeed an even.");
                }
            }
            await sleep(5000);
            if (success) {
                typewrite("Well done.");
                doEnding("determination");
                await sleep(4000);
                window.location.href = "https://vw4kks4wwkoswgks4k000gso.a.selfhosted.hackclub.com/scenes/79";
            } else {
                typewrite("It hasn't been going so well, has it?");
                await sleep(4500);
                typewrite("No more chances. I'm afraid I'll have to send you back.");
                await sleep(4500);
                typewrite("I'm going to roll another D6. This determines what neighbor you'll end up on.");
                await sleep(6000);
                typewrite("Odds is 73, even is 56.");
                await sleep(4500);
                typewrite("I rolled..");
                const ran = (Math.floor(Math.random() * 6) + 1) * ran_mult; // TODO: can't be 0
                await sleep(2500);
                if (Math.abs(ran % 2) == 1) { // odd https://stackoverflow.com/a/6211660
                    typewrite(".. " + ran + ".. an odd.");
                    await sleep(3500);
                    doEnding("attempt");
                    typewrite("Thanks for playing my game.");
                    await sleep(3000);
                    window.location.href = "https://vw4kks4wwkoswgks4k000gso.a.selfhosted.hackclub.com/scenes/73";
                } else if (ran % 2 == 0) { // even https://stackoverflow.com/a/6211660
                    typewrite(".. " + ran + ".. an even.");
                    await sleep(3500);
                    doEnding("attempt");
                    typewrite("Thanks for playing my game.");
                    await sleep(3000);
                    window.location.href = "https://vw4kks4wwkoswgks4k000gso.a.selfhosted.hackclub.com/scenes/56";
                }
            }
        }
        /* https://www.sitepoint.com/delay-sleep-pause-wait/ */
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        var typewrite_i = 0;
        function typewrite(txt, i = 0, refresh = true) {
            if (refresh) {
                document.getElementById("typewrite").textContent = "";
            }
            document.getElementById("typewrite").textContent += txt.charAt(i);
            if (i < txt.length - 1) {
                setTimeout(() => typewrite(txt, i + 1, false), 75);
            }
        }
        function letMePass() {
            ran_mult = 9000;
            console.log("sure thing..");
        }
        function doEnding(ending) {
            document.getElementById("ending-card").style.display = "block";
            playPause(false);
            document.getElementById("ending-popup-sound").play();
            for (const item in endings) {
                if (item == ending) {
                    saveEnding(ending);
                    document.getElementById("ending-name").textContent = endings[item].name;
                    document.getElementById("ending-description").textContent = endings[item].description;
                    document.getElementById("ending-collected").textContent = Object.keys(JSON.parse(localStorage.getItem("spanky_endings_collected"))).length + " / 5 Endings Collected";
                }
            }
            saveEnding(ending);
        }
        /* https://stackoverflow.com/a/64521347 */
        function playPause(playing) {
            const song = document.querySelector('#main-ambience');
            if (playing) {
                //relevant part to fading in audio
                song.volume = 0;
                $('#main-ambience').animate({volume: 1.0}, 1000);
                song.play();

                playing = false;
            } else {
                //relevant part to fading out audio
                song.volume = 1;
                $('#main-ambience').animate({volume: 0.5}, 1000, function() {
                    song.pause();
                });

                playing = true;
            }
        }
        function saveEnding(ending) {
            var endings = localStorage.getItem("spanky_endings_collected");
            if (!endings) {
                localStorage.setItem("spanky_endings_collected", JSON.stringify({}));
                endings = localStorage.getItem("spanky_endings_collected");
            }
            var items = JSON.parse(localStorage.getItem("spanky_endings_collected"));
            items[ending] = true
            localStorage.setItem("spanky_endings_collected", JSON.stringify(items));
        }
        function hasEnding(ending) {
            const endingsStr = localStorage.getItem("spanky_endings_collected");
            if (!endingsStr) return false;
            const endings = JSON.parse(endingsStr);
            if (endings[ending] === true) {
                return true;
            } else {
                return false;
            }
        }
        function loadEndings() {
            for (const item in endings) {
                const trophy = document.createElement("img");
                trophy.src = "assets/trophy-solid-full.svg";
                trophy.width = "32";
                trophy.height = "32";
                if (!hasEnding(item)) trophy.classList.add("greyed-out");
                document.getElementById("ending-list").appendChild(trophy);
            }
            //if (hasEnding())
        }
        loadEndings();
    </script>
</body>
</html>