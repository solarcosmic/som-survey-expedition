<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spanky's Mysterious Dice Rolling Simulator (solarcosmic.net)</title>
    <link rel="icon" type="image/png" href="assets/favicon.png"></link>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Epunda+Slab:ital,wght@0,300..900;1,300..900&display=swap');
        * {
            font-family: "Epunda Slab", sans-serif;
        }
        body {
            background-color: black;
            color: #ffffff;
            text-align: center;
            height: 100vh;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            user-select: none;
        }
        .select-button {
            display: none;
            color: #ffffff;
            background-color: black;
            padding: 16px 16px;
        }
        #click-anywhere {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: black;
            color: #ffffff;
            text-align: center;
            cursor: pointer;
            font-size: 30px;
        }
        #click-anywhere-text {
            opacity: 1;
            transition: 1s;
        }
        #click-anywhere-text.fade-out {
            opacity: 0;
            transition: 1s;
        }
        .select-button.fade-in {
            opacity: 1;
            transition: 1s;
        }
        .select-button.fade-out {
            opacity: 0;
            transition: 1s;
        }
        #typewrite {
            font-size: 25px;
        }
    </style>
</head>
<body>
    <div id="click-anywhere"><span id="click-anywhere-text">Click anywhere</span></div>
    <div id="container">
        <span id="typewrite"></span>
        <button id="roll_die" class="item select-button">roll the d20..</button>
        <p id="rolled"></p>
        <audio id="main-ambience" src="assets/assets_sounds_orch_hit_new.mp3" preload="auto" loop></audio>
        <button id="odd" class="item select-button" style="display: none;">Odd</button>
        <button id="even" class="item select-button" style="display: none;">Even</button>
    </div>
    <script>
        const rolldie = document.getElementById("roll_die");
        const click_anywhere = document.getElementById("click-anywhere");
        var ran_mult = 1;
        var isSecondTime = false;
        var selection = "odds";
        click_anywhere.addEventListener("click", () => {
            document.getElementById("click-anywhere-text").classList.add("fade-out");
            setTimeout(async () => {
                click_anywhere.style.display = "none";
                document.getElementById("main-ambience").play();
                typewrite("Welcome to Spanky's...");
                rolldie.classList.add("fade-out");
                await sleep(5000);
                var hrs = new Date().getHours()
                const isDayTime = hrs > 6 && hrs < 20 // https://stackoverflow.com/a/46908558
                var timeOfDay = "right now?";
                if (hrs > 6 && hrs < 12) {
                    timeOfDay = "this morning?";
                } else if (hrs >= 12 && hrs < 18) {
                    timeOfDay = "this afternoon?";
                } else if (hrs >= 18 && hrs < 24) {
                    timeOfDay = "tonight?";
                }
                typewrite("Feeling hopeful " + timeOfDay);
                await sleep(5000);
                typewrite("That's brilliant, but you have a choice to make.");
                await sleep(7000);
                typewrite("Click the button to roll a D20, and let's see what you get.");
                await sleep(7000);
                rolldie.style.display = "block";
                rolldie.classList.remove("fade-out");
                rolldie.classList.add("fade-in");
                var hasClicked = false;
                rolldie.addEventListener("click", async () => {
                    if (hasClicked) return;
                    hasClicked = true;
                    const ran = Math.floor(Math.random() * 21) * ran_mult; // TODO: can't be 0
                    rolldie.classList.remove("fade-in");
                    rolldie.classList.add("fade-out");
                    typewrite("You rolled a...");
                    await sleep(3500);
                    rolldie.classList.remove("fade-out");
                    rolldie.style.display = "none";
                    if (ran == 4 || ran == 13) {
                        typewrite(".. " + ran + " .. unlucky for some.");
                    } else if (ran < 10) {
                        typewrite(".. " + ran + " .. that's low.");
                    } else if (ran >= 10 && ran < 15) {
                        typewrite(".. " + ran + " .. that's alright.");
                    } else if (ran >= 15 && ran < 18) {
                        typewrite(".. " + ran + " .. that's not too bad.");
                    } else if (ran >= 18 && ran <= 19) {
                        typewrite(".. " + ran + " .. that's near perfect.");
                    } else if (ran == 20) {
                        typewrite(".. " + ran + " .. nat 20.");
                    } else if (ran > 20) {
                        typewrite(".. " + ran + " .. somehow higher than 20.. hmm..");
                    }
                    await sleep(5000);
                    console.log(isSecondTime);
                    if (isSecondTime == false) {
                        console.log("triggered");
                        if (ran < 18) {
                            typewrite(".. but not good enough.");
                            await sleep(6000);
                            typewrite("I'll let you reroll again, but on one condition.");
                            await sleep(6000);
                            typewrite("Prove to me you are worthy of advancing.");
                            await sleep(5000);
                            var hasClicked = false;
                            isSecondTime = true
                            rolldie.style.display = "block";
                        } else if (ran >= 18) {
                            typewrite("Well done.");
                            await sleep(3500);
                            typewrite("Since you have proved to me that you are capable, I'll let you proceed.");
                            await sleep(8000);
                            window.location.href = "https://isle.a.hackclub.dev/scenes/79";
                        }
                    } else if (isSecondTime == true) {
                        if (ran < 18) {
                            typewrite("Since you have not proved to me you are capable, I'll roll a D6.");
                            await sleep(6500);
                            typewrite("Let's make this 50/50. Odd or even?");
                            await sleep(4000);
                            document.getElementById("odd").style.opacity = 1;
                            document.getElementById("even").style.opacity = 1;
                            document.getElementById("odd").style.display = "block";
                            document.getElementById("even").style.display = "block";
                            document.getElementById("odd").classList.add("fade-in");
                            document.getElementById("even").classList.add("fade-in");
                            //rolldie.classList.add("fade-out");
                        } else if (ran >= 18) {
                            typewrite("For your second try, well done.");
                            await sleep(3500);
                            typewrite("Since you have proved to me that you are capable, I'll let you proceed.");
                            await sleep(8000);
                            window.location.href = "https://isle.a.hackclub.dev/scenes/79";
                        }
                    }
                })
            }, 2000);
        })
        /* https://www.sitepoint.com/delay-sleep-pause-wait/ */
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        var typewrite_i = 0;
        function typewrite(txt, i = 0, refresh = true) {
            if (refresh) {
                document.getElementById("typewrite").textContent = "";
            }
            document.getElementById("typewrite").textContent += txt.charAt(i);
            if (i < txt.length - 1) {
                setTimeout(() => typewrite(txt, i + 1, false), 75);
            }
        }
        function letMePass() {
            ran_mult = 9000;
            console.log("sure thing..");
        }
    </script>
</body>
</html>